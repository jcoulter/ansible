---
# version: '3.3'
# services:
#     transmission-openvpn:
#         cap_add:
#             - NET_ADMIN
#         volumes:
#         environment:
#             - OPENVPN_PROVIDER=SURFSHARK
#             - OPENVPN_CONFIG=us
#             - OPENVPN_USERNAME=user
#             - OPENVPN_PASSWORD=pass
#             - LOCAL_NETWORK=192.168.0.0/16
#         logging:
#             driver: json-file
#             options:
#                 max-size: 10m
#         ports:
#             - '9091:9091'
#         image: 

- name: Make sure the transmission vpn container is created and running
  become: yes
  docker_container:
    image: "haugene/transmission-openvpn"
    name: "transmission-openvpn"
    capabilities:
      - NET_ADMIN
    ports:
      - '9091:9091'
    pull: yes
    networks:
      - name: media_network
        ipv4_address: "{{ transmission_ip }}"
    state: 'started'
    env:
      OPENVPN_PROVIDER: SURFSHARK
      # OPENVPN_CONFIG: us-dtw_udp
      OPENVPN_CONFIG: us-dtw.prod.surfshark.com_udp
      OPENVPN_USERNAME: "{{ vpn_username }}"
      OPENVPN_PASSWORD: "{{ vpn_password }}"
      LOCAL_NETWORK: "192.168.0.0/16,{{ media_subnet }}"
      PUID: "{{ puid }}"
      PGID: "{{ pgid }}"
      TZ: "{{ timezone }}"
      # No idea how to actually set these
      TRANSMISSION_WEB_UI: transmission-web-control
      TRANSMISSION_RATIO_LIMIT_ENABLED: "true"
      TRANSMISSION_DOWNLOAD_QUEUE_SIZE: "25"
    volumes:
      - "{{ data_root }}/transmission/data:/data"
      # - "{{ config_root }}/transmission:/config"
      # - "{{ data_root }}/transmission/downloads:/downloads"
    restart_policy: unless-stopped
